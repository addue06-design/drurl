import asyncio
from playwright.async_api import async_playwright

async def run():
    async with async_playwright() as p:
        browser = await p.chromium.launch(headless=True)
        page = await browser.new_page()
        
        # ç›®æ¨™ï¼šéå‡¡ ç¬¬ 5 é›†
        url = "https://dramasq.io/vodplay/202500838/ep5.html"
        print(f"ğŸ“¡ æ­£åœ¨æƒæ: {url}")
        
        m3u8_links = set()
        # æ””æˆªæ‰€æœ‰ m3u8
        page.on("request", lambda req: m3u8_links.add(req.url) if ".m3u8" in req.url else None)
        
        try:
            await page.goto(url, wait_until="domcontentloaded")
            # æ¨¡æ“¬äººé¡é»æ“Šè¢å¹•ä¸­å¤®ï¼Œé€™é€šå¸¸æ˜¯è§¸ç™¼ m3u8 è«‹æ±‚çš„é—œéµ
            await asyncio.sleep(5)
            await page.mouse.click(640, 360) 
            await asyncio.sleep(15) # çµ¦äºˆè¶³å¤ å¯¬è£•çš„æ™‚é–“
            
            # ä¸ç®¡æœ‰æ²’æœ‰æŠ“åˆ°ï¼Œéƒ½å¯«å…¥ä¸€å€‹ç‹€æ…‹æª”æ¡ˆ
            with open("log_status.txt", "w", encoding="utf-8") as f:
                f.write(f"æƒææ™‚é–“: 2025-12-22\n")
                if m3u8_links:
                    f.write("âœ… æˆåŠŸæŠ“å–ç¶²å€:\n")
                    for link in m3u8_links:
                        f.write(f"{link}\n")
                else:
                    f.write("âŒ æƒæå®Œæˆä½†æœªç™¼ç¾ m3u8 é€£çµã€‚\n")
                    # æŠ“ä¸åˆ°å°±å­˜ä¸€å¼µæˆªåœ–çš„ base64 æˆ–è€…æ˜¯é é¢æ¨™é¡Œä¾†è¨ºæ–·
                    title = await page.title()
                    f.write(f"é é¢æ¨™é¡Œ: {title}\n")

            print("ğŸ“ åŸ·è¡Œæ—¥èªŒå·²å¯«å…¥ log_status.txt")
            
        except Exception as e:
            with open("log_status.txt", "w") as f:
                f.write(f"ğŸ’¥ ç¨‹å¼å ±éŒ¯: {str(e)}")
        finally:
            await browser.close()

if __name__ == "__main__":
    asyncio.run(run())
